@using Microsoft.AspNetCore.Mvc.TagHelpers
@using UKMCAB.Data
@using UKMCAB.Web.UI.Models.ViewModels.Admin.CAB
@model UKMCAB.Web.UI.Models.ViewModels.Admin.CAB.FileListViewModel
@section BackButton
    {
    <div class="govuk-width-container ">
        <div class="govuk-grid-row">
            <div class="govuk-grid-column-two-thirds">
                @if (Model.IsFromSummary)
                {
                    <a asp-area="Admin" asp-controller="CAB" asp-action="Summary" asp-route-id="@Model.CABId" class="govuk-back-link">Back</a>
                }
                else
                {
                    <a asp-area="Admin" asp-controller="FileUpload" asp-action="DocumentsUpload" asp-route-id="@Model.CABId" class="govuk-back-link">Back</a>
                }
            </div>
        </div>
    </div>
}

<div class="govuk-grid-row">
    <div id="schedule-list-container" class="govuk-grid-row">

        @if (Model.UploadedFiles != null && Model.UploadedFiles.Any(f => f.IsDuplicated) && ViewData.ModelState.IsValid)
        {
            <div class="govuk-width-container">
                <div class="govuk-grid-row">
                    <div class="govuk-grid-column-two-thirds">
                        <div class="govuk-notification-banner govuk-notification-banner--success" role="alert"
                             aria-labelledby="govuk-notification-banner-title"
                             data-module="govuk-notification-banner">
                            <div class="govuk-notification-banner__header">
                                <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title">
                                    Success
                                </h2>
                            </div>
                            <div class="govuk-notification-banner__content">
                                <h3 class="govuk-notification-banner__heading">
                                    The file has been used again
                                </h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }

        <form method="post" enctype="multipart/form-data" novalidate>
            <div class="govuk-grid-column-full">

                <partial name="Partials/_ValidationSummary" model="null" />

                <div>
                    <input type="hidden" asp-for="IsFromSummary" />
                    <span class="govuk-caption-m">@Model.Title</span>
                    <h1 class="govuk-heading-l">@Model.Title</h1>
                    <p class="govuk-body govuk-!-padding-bottom-2">You can upload Word, Excel or PDF documents.</p>
                </div>

                @if (!Model.UploadedFiles.Any())
                {
                    <p class="govuk-body">0 file uploaded</p>
                }
                else
                {
                    <div class="govuk-form-group @Html.ShowModelStateFormGroupErrorClass(ViewData.ModelState, nameof(Model.UploadedFiles))">
                        <fieldset class="govuk-fieldset" aria-describedby="enter-file-title-hint">
                            <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
                                <h2 class="govuk-heading-s">
                                    Files you have uploaded
                                </h2>
                                <div id="enter-file-title-hint" class="govuk-hint">
                                    Select a category for the file.
                                </div>
                            </legend>

                            <p id="UploadedFiles" class="govuk-error-message">
                                <span asp-validation-for="UploadedFiles" class="govuk-error-message"></span>
                            </p>

                            @* Header*@
                            <div>
                                <div class="width-thirteen-twentieth ukmcab-float__left mobile-no-display"><h3 class="govuk-heading-s">File</h3></div>
                                <div class="ukmcab-float__left"><h3 class="govuk-heading-s ukmcab-padding-left-40 mobile-no-display">Category</h3></div>
                            </div>

                            <div class="ukmcab-float__left width-full"><hr class="ukmcab-border" /></div>


                            <div class="govuk-checkboxes govuk-checkboxes--small" data-module="govuk-checkboxes">

                                @for (int i = 0; i < Model.UploadedFiles.Count; i++)
                                {
                                    var uploadedFile = Model.UploadedFiles[i];
                                    var items = DataConstants.Lists.DocumentCategories.Select(s => new SelectListItem(s, s, s.Equals(uploadedFile.Category?.Trim() ?? string.Empty))).ToList();

                                    <div class="govuk-checkboxes__item">
                                        @*Row 1: Checkbox Row*@
                                        <div class="row">
                                            <div class="width-one-tenth">
                                                <input type="hidden" asp-for="UploadedFiles[i].FileIndex" value="@i" />
                                            </div>

                                            <div class="width-three-fifth ukmcab-float__left ukmcab-min-width__350">
                                                <input class="govuk-checkboxes__input file-upload-checkbox" type="checkbox" asp-for="UploadedFiles[i].IsSelected" />
                                                <label class="govuk-label govuk-checkboxes__label" asp-for="UploadedFiles[i].IsSelected">
                                                    <span class="file-number">@(i + 1).</span> <a class="govuk-link file-link" asp-area="Search" asp-controller="CABProfile" asp-action="Download" asp-route-id="@Model.CABId" asp-route-file="@uploadedFile.FileName" asp-route-filetype="@DataConstants.Storage.Documents">@uploadedFile.FileName</a>
                                                </label>
                                                @if (uploadedFile.IsDuplicated)
                                                {
                                                    <label class="govuk-body govuk-!-font-weight-bold govuk-colour-green">New</label>
                                                }

                                            </div>
                                        </div>
                                    </div>

                                    @*Row 2: Inputbox Row*@
                                    <div class="row">
                                        <div class="width-three-fifth ukmcab-padding-left-35 ukmcab-padding-bottom-15 ukmcab-float__left">
                                            <div class="govuk-form-group @Html.ShowModelStateFormGroupErrorClass(ViewData.ModelState, $"UploadedFiles[{i}].Label")">
                                                <label class="govuk-label govuk-label--s desktop-no-display" asp-for="UploadedFiles[i].Label">File</label>
                                                <p class="govuk-error-message">
                                                    <span asp-validation-for="UploadedFiles[i].Label" class="govuk-error-message"></span>
                                                </p>
                                                <input asp-for="UploadedFiles[i].Label" type="text" id="UploadedFiles[@i].Label" class="govuk-input @Html.ShowModelStateInputErrorClass(ViewData.ModelState, $"UploadedFiles[{i}].Label")" value="@uploadedFile.Label" aria-required="true" maxlength="150">
                                                <input asp-for="UploadedFiles[i].FileName" type="hidden" value="@uploadedFile.FileName">
                                                <input asp-for="UploadedFiles[i].IsDuplicated" type="hidden" value="@uploadedFile.IsDuplicated">
                                            </div>
                                        </div>

                                        <div class="width-three-tenth ukmcab-padding-left-40 ukmcab-float__left govuk-form-group @Html.ShowModelStateFormGroupErrorClass(ViewData.ModelState, $"UploadedFiles[{i}].Category")">
                                            <label class="govuk-label govuk-label--s desktop-no-display" asp-for="UploadedFiles[i].Category">Category</label>
                                            <p class="govuk-error-message">
                                                <span asp-validation-for="UploadedFiles[i].Category" class="govuk-error-message"></span>
                                            </p>
                                            <select id="UploadedFiles[@i].Category" name="UploadedFiles[@i].Category" class="govuk-select @Html.ShowModelStateSelectErrorClass(ViewData.ModelState, $"UploadedFiles[{i}].Category")">
                                                <option value="">Not assigned</option>
                                                @foreach (var cat in items)
                                                {
                                                    if (cat.Selected)
                                                    {
                                                        <option value="@cat.Value" selected="selected">@cat.Text</option>
                                                    }
                                                    else
                                                    {
                                                        <option value="@cat.Value">@cat.Text</option>
                                                    }
                                                }
                                            </select>
                                        </div>

                                    </div>
                                    <div class="ukmcab-float__left width-full"><hr class="ukmcab-border" /></div>
                                }
                            </div>
                        </fieldset>
                    </div>
                }


                <div class="govuk-grid-column-one-half">
                    @if (Model.UploadedFiles.Any())
                    {
                        <div class="govuk-button-group">
                            <input id="remove-or-use-it-again-btn-group" type="submit" class="govuk-button govuk-button--secondary" data-module="govuk-button" name="submitType" value="@Constants.SubmitType.Remove" />
                            <a asp-area="Admin" asp-controller="FileUpload" asp-action="DocumentsUseFileAgain" asp-route-id="@Model.CABId" class="govuk-link govuk-link--no-visited-state">
                                Use file again
                            </a>
                        </div>
                    }
                </div>


                <div class="govuk-grid-column-one-half ukmcab-text-aligin-right">
                    <button class="govuk-button govuk-button--secondary" data-module="govuk-button" name="submitType" value="@Constants.SubmitType.UploadAnother">
                        @Html.Conditional(Model.UploadedFiles.Any(), "Save and upload another file" , "Upload a file")
                    </button>
                </div>


                <div class="govuk-grid-column-two-thirds">
                    <div class="govuk-button-group ukmcab-padding-top-50">
                        <button class="govuk-button" data-module="govuk-button" name="submitType" value="@Constants.SubmitType.Continue">
                            @Html.Conditional(Model.UploadedFiles.Any(), "Save and continue", "Save")
                        </button>
                        <button class="govuk-button govuk-button--secondary" data-module="govuk-button" name="submitType" value="@Constants.SubmitType.Save">
                            Save as draft
                        </button>

                        @if (Model.IsFromSummary)
                        {
                            <a asp-area="admin" asp-controller="CAB" asp-action="Summary" asp-route-id="@Model.CABId" class="govuk-link govuk-link--no-visited-state">Cancel</a>
                        }
                        else
                        {
                            <a asp-area="admin" asp-controller="CabManagement" asp-action="CABManagement" asp-route-id="@Model.CABId" class="govuk-link govuk-link--no-visited-state">Cancel</a>
                        }
                    </div>
                </div>

        </form>
    </div>








    @*
    <form method="post" enctype="multipart/form-data" novalidate>
        <div class="govuk-grid-column-full">
            <input type="hidden" asp-for="IsFromSummary" />
            <span class="govuk-caption-m">@Model.Title</span>
            <h1 class="govuk-heading-l">@Model.Title</h1>
            <p class="govuk-body govuk-!-padding-bottom-2">You can upload up to @DocumentsOptions.MaxFileCount Word, Excel or PDF documents.</p>

            <div id="file-upload-list-container">
                <h3 class="govuk-label-wrapper">
                    <label class="govuk-label govuk-label--s" for="files-uploaded-table">
                        Files you have uploaded
                    </label>
                </h3>
                <div class="govuk-hint" id="files-uploaded-table-hint">
                    Select a category for the file.
                </div>
                <table class="govuk-table" id="doc-list-files-uploaded-table" aria-describedby="files-uploaded-table-hint">
                    <thead class="govuk-table__head">
                        <tr class="govuk-table__row">
                            <th scope="col" class="govuk-table__header width-one-twentieth">File</th>
                            <th scope="col" class="govuk-table__header width-three-fifth"></th>
                            <th scope="col" class="govuk-table__header">Category</th>
                        </tr>
                    </thead>
                    <tbody class="govuk-table__body">
                        @if (!Model.UploadedFiles.Any())
                        {
                            <tr class="govuk-table__row">
                                <td class="govuk-table__cell" colspan="3">0 file uploaded</td>
                            </tr>
                        }
                        else
                        {
                            for (int i = 0; i < Model.UploadedFiles.Count; i++)
                            {
                                var uploadedFile = Model.UploadedFiles[i];
                                var items = DataConstants.Lists.DocumentCategories.Select(s => new SelectListItem(s, s, s.Equals(uploadedFile.Category?.Trim() ?? string.Empty))).ToList();

                                <tr id="uploaded-file-name-tr">
                                    <td>
                                        <div class="checkboxes-itemX govuk-checkboxes--small">
                                            <input class="file-upload-checkbox" type="checkbox" asp-for="UploadedFiles[i].IsSelected" />
                                            <input type="hidden" asp-for="UploadedFiles[i].FileIndex" value="@i" />
                                        </div>
                                    </td>
                                    <td id="uploaded-file-name-td">
                                        <p class="govuk-body"><span class="file-number">@(i + 1).</span> <a class="govuk-link file-link" asp-area="Search" asp-controller="CABProfile" asp-action="Download" asp-route-id="@Model.CABId" asp-route-file="@uploadedFile.FileName" asp-route-filetype="@DataConstants.Storage.Documents">@uploadedFile.FileName</a></p>
                                    </td>
                                </tr>

                                //ROW 2:
                                <tr class="govuk-table__row" id="document-list-row" style="vertical-align: bottom">
                                    <td></td>
                                    <td class="govuk-table__cell uploaded-file-attribute">
                                        <govuk-input asp-for="UploadedFiles[i].Label" type="text" id="UploadedFiles[@i].Label" value="@uploadedFile.Label" aria-required="true" maxlength="150">
                                            <govuk-input-label class="govuk-label govuk-label--s">File</govuk-input-label>
                                        </govuk-input>
                                        <input asp-for="UploadedFiles[i].FileName" type="hidden" value="@uploadedFile.FileName" />
                                        <input asp-for="UploadedFiles[i].IsDuplicated" type="hidden" value="@uploadedFile.IsDuplicated">
                                    </td>
                                    <td class="govuk-table__cell uploaded-file-attribute">
                                        <govuk-select id="UploadedFiles[@i].Category" asp-for="UploadedFiles[i].Category">
                                            <govuk-select-label class="govuk-label govuk-label--s">Category</govuk-select-label>
                                            <govuk-select-item value="">Not assigned</govuk-select-item>
                                            @foreach (var la in items)
                                            {
                                                if (la.Selected)
                                                {
                                                    <govuk-select-item value="@la.Value" selected="true">@la.Text</govuk-select-item>
                                                }
                                                else
                                                {
                                                    <govuk-select-item value="@la.Value">@la.Text</govuk-select-item>
                                                }
                                            }
                                        </govuk-select>
                                    </td>

                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>


        BUTTONS

        <div class="govuk-grid-column-full">
            <p class="govuk-error-message">
                <span name="remove-or-use-it-again-btn-group" class="govuk-error-message">@Html.ValidationMessage("remove-or-use-it-again-btn-group", "")</span>
            </p>
        </div>
        <div class="govuk-grid-column-one-half">
            @if (Model.UploadedFiles.Any())
            {
                <div class="govuk-button-group">
                    <input id="remove-or-use-it-again-btn-group" type="submit" class="govuk-button govuk-button--secondary" data-module="govuk-button" name="submitType" value="@Constants.SubmitType.Remove" />
                    <button class="govuk-button govuk-button--secondary" data-module="govuk-button" name="submitType" value="@Constants.SubmitType.UseFileAgain">
                        Use file again
                    </button>
                </div>
            }
        </div>

        @if (Model.UploadedFiles.Count < DocumentsOptions.MaxFileCount)
        {
            <div class="govuk-grid-column-one-half ukmcab-text-aligin-right">
                <button class="govuk-button govuk-button--secondary" data-module="govuk-button" name="submitType" value="@Constants.SubmitType.UploadAnother">
                    @Html.Conditional(Model.UploadedFiles.Any(), "Save and upload another file" , "Upload a file")
                </button>
            </div>
        }

        <div class="govuk-grid-column-two-thirds">
            <div class="govuk-button-group ukmcab-padding-top-50">
                <button class="govuk-button" data-module="govuk-button" name="submitType" value="@Constants.SubmitType.Continue">
                    @Html.Conditional(Model.UploadedFiles.Any(), "Save and continue", "Save")
                </button>
                <button class="govuk-button govuk-button--secondary" data-module="govuk-button" name="submitType" value="@Constants.SubmitType.Save">
                    Save as draft
                </button>

                @if (Model.IsFromSummary)
                {
                    <a asp-area="admin" asp-controller="CAB" asp-action="Summary" asp-route-id="@Model.CABId" class="govuk-link govuk-link--no-visited-state">Cancel</a>
                }
                else
                {
                    <a asp-area="admin" asp-controller="CabManagement" asp-action="CABManagement" asp-route-id="@Model.CABId" class="govuk-link govuk-link--no-visited-state">Cancel</a>
                }
            </div>
        </div>

    </form>


    *@


</div>
