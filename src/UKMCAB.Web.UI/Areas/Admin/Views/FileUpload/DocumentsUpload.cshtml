@using UKMCAB.Data.Models
@model UKMCAB.Web.UI.Models.ViewModels.Admin.FileUploadViewModel

@section BackButton
{
    <div class="govuk-width-container ">
        <div class="govuk-grid-row">
            <div class="govuk-grid-column-two-thirds">
                @if (Model.IsFromSummary)
                {
                    <a asp-area="Admin" asp-controller="CAB" asp-action="Summary" asp-route-id="@Model.CABId" class="govuk-back-link">Back</a>
                }
                else
                {
                    <a asp-area="Admin" asp-controller="FileUpload" asp-action="SchedulesList" asp-route-id="@Model.CABId" class="govuk-back-link">Back</a>
                }
            </div>
        </div>
    </div>
}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        <partial name="Partials/_ValidationSummary" model="null"/>
        <span class="govuk-caption-m">@Model.Title</span>
        <h1 class="govuk-heading-l">@Model.Title</h1>
        <p class="govuk-body govuk-!-padding-bottom-2">You can upload up to 10 Word, Excel, or PDF documents.</p>
            
        <div id="file-upload-list-container">
            @using (Html.BeginForm("DocumentsList", "FileUpload", Model.IsFromSummary ? new { area = "admin", id = @Model.CABId, fromSummary = "true" } : new { area = "admin", id = @Model.CABId }, FormMethod.Post, false, new { enctype = "multipart/form-data", novalidate = "true" }))
            {
                <table class="govuk-table">
                    <thead class="govuk-table__head doc-upload-thead">
                        <tr>
                            <th scope="row" colspan="1"></th>
                            <th scope="row" colspan="1"></th>
                            <th scope="row" colspan="1"></th>
                        </tr>
                    <tr class="govuk-table__row">
                        <th scope="row" class="govuk-table__header" colspan="3">Files you have uploaded</th>
                    </tr>
                    </thead>
                    <tbody class="govuk-table__body">
                    @if (!Model.UploadedFiles.Any())
                    {
                        <tr class="govuk-table__row">
                            <td class="govuk-table__cell" colspan="3">0 file uploaded</td>
                        </tr>
                    }
                    else
                    {
                        var index = 1;
                        foreach (var uploadedFile in Model.UploadedFiles)
                        {
                            <tr class="govuk-table__row">
                                    <td class="govuk-table__cell file-upload-col-1x">@(index++).</td>
                                    <td class="govuk-table__cell file-upload-col-2x">@uploadedFile.FileName</td>
                                    <td class="govuk-table__cell file-upload-col-3x"><button class="govuk-link govuk-link--no-visited-state app-button-link remove-file-button-link" name="fileName" value="@uploadedFile.FileName">Remove</button></td>
                            </tr>
                        }
                    }
                    </tbody>
                </table>
            }
        </div>
        
    </div>
</div>

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        <form class="js-submit-once" method="post" enctype="multipart/form-data" novalidate>
            <input type="hidden" asp-for="IsFromSummary" onsubmit="" />
            <div class="govuk-form-group @Html.ShowModelStateFormGroupErrorClass(ViewData.ModelState,"File")">
                <label class="govuk-label govuk-!-font-weight-bold" asp-for="File">
                    Select a file
                </label>
                <span asp-validation-for="File" class="govuk-error-message"></span>
                <input class="govuk-file-upload schedules-upload" asp-for="File" accept=".doc,.docx,.xls,.xlsx,.pdf" type="file">
            </div>
                
            <div class="govuk-grid-row">
                <div class="govuk-grid-column-two-thirds govuk-!-padding-bottom-5">
                    <p class="govuk-body"><a class="govuk-link govuk-link--no-visited-state" asp-area="Admin" asp-controller="CAB" asp-action="Summary" asp-route-id="@Model.CABId">Skip this step</a></p>
                </div>
            </div>
            <div class="govuk-button-group">
                <button class="govuk-button js-submit-button" data-module="govuk-button" name="submitType" value="upload" data-submitting-text="Uploading...">
                    Upload
                </button>
                <a class="govuk-button govuk-button--secondary" asp-area="Admin" asp-controller="FileUpload" asp-action="SaveAsDraft" asp-route-id="@Model.CABId">
                    Save as draft
                </a>
                @if (Model.IsFromSummary)
                {
                    <a asp-area="admin" asp-controller="CAB" asp-action="Summary" asp-route-id="@Model.CABId" class="govuk-link govuk-link--no-visited-state">Cancel</a>
                }
                else
                {
                    <a asp-area="admin" asp-controller="Admin" asp-action="CABManagement" class="govuk-link govuk-link--no-visited-state">Cancel</a>
                }
            </div>
                
        </form>
    </div>
</div>    

